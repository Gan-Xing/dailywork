## 项目进度与报检需求说明（v3）

本文件为进度/报检模块的中文要点说明，覆盖跳跃设计段、封锁逻辑、14:00 封板、管理员解锁等规则。无代码改动。

### 1) 目标与原则
- 进度仅由验收结果驱动；禁止手动改百分比。
- 线性工程按 PK 轴展示，分侧（G/D）配色：灰=非设计、白=未报检、橙=验收中、绿=已验收。
- 结构物用“结构层 × 工序”组合，支持部分验收；延米结构物需全部工序通过才变绿。
- 配置驱动：工种、层、工序、设计段均由管理员在元数据中维护。

### 2) 范围与入口
- 首页提供两个入口：项目进度、项目日报（并行存在，不合并）。
- 进度视图：道路 Tab → 总体进度条 → 线性工程卡片（G/D 条） → 结构物轴线（dalot/traversée/buse 图标） → 报检记录、结构物列表入口。

### 3) 设计段（可跳跃、不连续）
- 每个小项目的设计段由管理员配置，可多段跳跃且左右不对称（G ≠ D）。
- 非设计 PK 显示灰色，不能点击报检。
- 只有管理员可新增/修改设计段，工长无权调整。

### 4) 线性工程状态与封锁
- 状态：待处理 → 已预约 → 已报检 → 验收中 → 已验收（取最新记录）。
- 层级（低→高）：1 土方, 2 垫层, 3 底基层, 4 基层, 5 透层, 6 粘层, 7 面层路面, 8 面层路肩。
- 封锁规则：某段 PK 的第 N 层被验收通过后，同段所有低于 N 的层被锁定，禁止再报检；高层不受影响。
- 延米结构物（buse/边沟/路缘石）已验收段不可再次报检，除非管理员手动解锁或回退状态。

### 5) 结构物逻辑
- 点状/短段结构物（dalot/traversée）：Layer × Step 矩阵，报检支持多选，部分验收。组合状态：未处理 / 验收中 / 已验收。
- 延米结构物（buse、边沟、路缘石）：某段只有全部配置工序通过才变绿；有未完工序则保持橙色。

### 6) 报检创建交互（进度视图）
- 点击反馈：灰色=“不在设计范围”，绿色=“已验收，需管理员解锁”，白/橙=打开报检弹窗。
- 弹窗默认：只读展示道路/分项/侧别/PK 起止（取点击段）；白/橙可报检/编辑，灰/绿禁用或提示需管理员解锁。
- 弹窗必填项：
  - 层次：多选（如“第一层上土/第二层上土”），来源于分项维护时配置的“常见层次”列表。
  - 验收内容：多选，来源于分项维护时配置的“常见验收内容”列表，可在分项维护中增删条目。
  - 验收类型：多选四个预设（现场验收、测量验收、试验验收、其他）。
  - 备注：文本域，记录位置/机具/试件编号等（可选）。
- 侧别/PK：默认取点击段，允许在设计范围内收缩；超出设计段或非设计区提示“超出设计段，无法报检”；双侧需对称，否则提示。
- 防重复：同一分项+侧别+区间+层次/验收内容如已存在“验收中”报检则阻止重复提交。
- 提交后段落变橙；验收通过变绿并触发封锁规则。

### 7) 报检记录与 14:00 封板
- 独立报检记录页：按日期分组，展示 PK、侧别、工种、工序、状态、创建人、时间、是否已封板。
- 提交即自动生成报检简介汇总到“今日报检单”列表（含日期、道路、工种、侧别、PK、工序、状态=验收中）。
- 可编辑窗口：工长可在当日 14:00 前修改当日提交的报检；14:00 触发封板，当日 14:00 前的报检变为只读。
- 管理员权限：可编辑任意日期报检、解锁已验收区、撤销验收、改结构层/工序状态、调整设计段、重置延米结构物验收。

### 8) 状态模型
- 任一可验收单元（PK 区间或 Layer×Step）的通用状态：待处理、已预约、已报检、验收中、已验收。唯一来源是报检 + 管理员结果；禁止直接改进度值。

### 9) 配置项
- WorkType：名称、isLinear、hasSide、hasStructureLayer、required steps（用于“全工序通过才绿”）。
- StructuralLayer / WorkflowStep：按结构物类型维护。
- WorkType ↔ Layer/Step 映射：定义合法组合；新增层/工序只需改配置。

### 10) 管理后台需求
- 管理道路与终点 PK。
- 管理各工种的设计段（含不连续 G/D 段）。
- 管理 WorkType/Layer/Step 配置与映射。
- 解锁/重置已验收区（线性与结构物）。
- 编辑任意报检记录并可撤销验收。
